if (self.CavalryLogger) { CavalryLogger.start_js(["VQISt"]); }

__d("XAssociateGroupThreadController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/groups/messenger/associate_group_thread/",{})}),null);
__d("XGroupSideConversationCreateController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/groups/side_conversation/",{post_id:{type:"Int"}})}),null);
__d("MultiChatController",["AsyncRequest","AsyncSignal","ChatOpenTabEventLogger","FantaTabActions","Form","MercuryDispatcher","MercuryIDs","MercuryLocalIDs","MercuryThreadIDMap","MercuryViewer","MercuryServerDispatcher","MercuryThreads","XAssociateGroupThreadController","XGroupSideConversationCreateController"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("MercuryDispatcher").get(),i=c("MercuryThreadIDMap").get(),j=c("MercuryThreads").get(),k=c("XGroupSideConversationCreateController").getURIBuilder().getURI().toString(),l=c("XAssociateGroupThreadController").getURIBuilder().getURI().toString();function m(){}Object.assign(m,{subscribe:function o(p,q){p.subscribe("confirm",function(){this.createGroupThreadFromChooserDialog(p,q)}.bind(this))},subscribeFromPost:function o(p,q){p.subscribe("confirm",function(){this.createGroupPostThreadFromChooserDialog(p,q)}.bind(this))},createGroupPostThreadFromChooserDialog:function o(p,q){var r=c("Form").serialize(p.getRoot()),s=JSON.parse(r.profileChooserItems),t=Object.keys(s).filter(function(u){return!!s[u]});m.createThreadForFBIDs(t);new(c("AsyncRequest"))().setURI(k).setData({post_id:q}).send();p.hide()},createGroupThreadFromChooserDialog:function o(p,q){__p&&__p();var r=c("Form").serialize(p.getRoot()),s=JSON.parse(r.profileChooserItems),t=[];for(var u in s)if(s[u])t.push(u);var v=m.createThreadForFBIDs(t),w=h.subscribe("update-thread-ids",function(x,y){for(var z in y)if(y[z]==v){var A=j.getThreadMetaNow(v),B=i.getServerIDFromClientIDNow(v);if(A&&!A.is_canonical&&B)c("MercuryServerDispatcher").trySend(l,{group_id:q,thread_id:B});new(c("AsyncSignal"))("/ajax/groups/chat/log",{group_id:q,message_id:z}).send();h.unsubscribe(w);break}});p.hide()},createThreadForTokens:function o(p){__p&&__p();var q=c("MercuryViewer").getID();if(!p.length)return;p=p.filter(function(s){return s!==q});var r;if(p.length===0)return;else if(p.length===1){r=c("MercuryIDs").getThreadIDFromParticipantID(p[0]);c("FantaTabActions").openTab(r,"created_locally_from_tokens");c("ChatOpenTabEventLogger").logAutoOpen("ChatTabView",r)}else{r=c("MercuryLocalIDs").generateThreadID();p.unshift(q);j.createNewLocalThread(r,p);c("FantaTabActions").openTab(r,"created_locally_from_tokens");c("ChatOpenTabEventLogger").logAutoOpen("MultiChatController",r)}return r},createThreadForFBIDs:function o(p){var q=[];for(var r=0;r<p.length;r++)q.push("fbid:"+p[r]);return m.createThreadForTokens(q)}});var n={};n[l]={mode:c("MercuryServerDispatcher").IMMEDIATE};c("MercuryServerDispatcher").registerEndpoints(n);f.exports=m}),null);
__d("FantaReducersSendMessages",["fbt","AsyncRequest","Bootloader","ChatTabViewEvents","CurrentUser","EmojiLikeUtils","EmojiState","FantaMessageActions","FantaTypeComposer","FantaTypeFileUploader","FantaTypeSharePreview","FantaTypeTabContents","MercuryAPIArgsSource","MercuryBlockedParticipants.bs","MercuryIDs","MercuryLogMessageType","MercuryMessageActions","MercuryMessageObject","MercuryParticipants","MercurySheetPolicy","MercurySourceType","MercuryThreadActions","MercuryThreadIDMap","MercuryThreadInfo","MercuryThreads","MessageRequestUtils","MessengerAdminGroupUtils","MessengerApprovalModeTypes","MessengerDiscoveryEntryPoint","MessengerDiscoveryEntryPointsLoggingHelper","MessengerEmojiUsageUtils","MessengerUploadFilesUtil.bs","MultiChatController","SimpleXUIDialog","SiteData","XMessagingSetThreadStateController","getPageIDFromThreadID","setImmediate"],(function aa(ba,a,ca,da,b,ea,c){"use strict";__p&&__p();var d=a("MercuryBlockedParticipants.bs").get(),e=a("MercuryMessageActions").get(),f=a("MercuryMessageObject").get(),g=a("MercuryThreadActions").get(),h=a("MercuryThreadIDMap").get(),i=a("MercuryThreads").get(),j=a("FantaMessageActions").Types,k=/^\s*$/,l="/ajax/chat/multichat/name_conversation/dismiss.php";function m(u,v){__p&&__p();switch(v.type){case j.UPDATE_GROUP_NAME:var w=v.threadID,x=v.newName,y=u.mercury.tabContents.get(w);if(!y)return u;var z=y,A=z.thread;if(!A)return u;var B=A.name,C=a("MessengerAdminGroupUtils").isJoinableThread(A);if((x||B)&&x!==B)if(!C)e.send(f.constructLogMessageObject(a("MercurySourceType").CHAT_WEB,w,a("MercuryLogMessageType").THREAD_NAME,{name:x}),null,a("MercuryAPIArgsSource").CHAT);else h.getServerIDFromClientID(w,function(D){var E=a("XMessagingSetThreadStateController").getURIBuilder().getURI();new(a("AsyncRequest"))().setURI(E).setData({thread_id:D,thread_name:x}).send()});h.getServerIDFromClientID(w,function(D){new(a("AsyncRequest"))(l).setData({thread_fbid:D}).send()});y=y.merge({openSheet:null});u=u.setIn(["mercury","tabContents",w],y)}return u}function n(u,v){__p&&__p();switch(v.type){case j.SEND_GROUP_MESSAGE:var w=v.threadID,x=u.mercury.tabContents.get(w),y=x,z=y.thread,A=y.typeahead;if(!A||!z)return u;var B=i.isEmptyLocalThread(w),C=A.getSelectedParticipantIDs();if(z.is_canonical_user||B){var D=z.participants;a("setImmediate")(function(){return a("MultiChatController").createThreadForTokens(D.concat(C))})}else{var E=a("MessengerAdminGroupUtils").shouldInvite(z);if(E)C.forEach(function(J){var K=a("MercuryIDs").getThreadIDFromParticipantID(J);if(K)e.send(f.constructUserGeneratedMessageObject(z.joinable_mode.link,a("MercurySourceType").CHAT_WEB,K))});else e.send(f.constructLogMessageObject(a("MercurySourceType").CHAT_WEB,w,a("MercuryLogMessageType").SUBSCRIBE,{added_participants:C}));var F=z.admin_ids.indexOf(a("CurrentUser").getID())!==-1;if(z.approval_mode===a("MessengerApprovalModeTypes").APPROVALS&&!F){var G=c._("New members need to be approved by an admin. This request was added to the approval queue."),H=c._("Approval pending");a("SimpleXUIDialog").show(G,H)}}var I=v.tabID||v.threadID;x=x.merge({typeahead:null});u=u.setIn(["mercury","tabContents",I],x)}return u}function o(u,v){__p&&__p();var w;switch(v.type){case j.SEND_HOT_LIKE:case j.SEND_MESSAGE:case j.SEND_PHOTO:case j.SEND_STICKER:var x=v.message,y=v.threadID,z=x?x.mentions:null;if(x)x=x.message;var A=u.tabGroup.tabs.get(y),B=A&&A.entryPoint||null;if(Array.isArray(B))B=B[0];switch(B){case"compose_link":B="chat_sidebar_new_message";break;case"jewel_new_message":B="jewel_new_message";break;case"created_locally_from_tokens":B="one_to_one_plus";break}var C=v.emoji,D=v.onSendSuccess,E=v.photoData,F=v.size,G=v.source,H=v.stickerID,I=v.composer,J=u.mercury.tabContents.get(y);if(!J)return u;var K=J,L=K.composer,M=K.signatureID,N=K.threadPreviewID,O=K.threadPreviewRecipients,P=L.fileUploader,Q=L.sharePreview;if(I&&L&&I.version!==L.version)return u;var R=N||y,S=J.thread,T=!!(!x&&C&&F),U=!!(!x&&H),V=i.isEmptyLocalThread(R);if(T)x=C;else if(U||E)x="";var W=S&&S.is_canonical&&!a("MercuryThreadInfo").canReply(S),X=!!(Q.params&&Q.type);if(p(P,Q)){J=J.merge({openSheet:a("MercurySheetPolicy").sheets.ChatUploadWarningTabSheet});u=u.setIn(["mercury","tabContents",y],J)}else if(W&&S)q(S);else if(!k.test(x)||P.uploadedFiles.size>0||X||U||E){var Y=a("MessengerEmojiUsageUtils").findAllEmojis(x);if(Y.length>0)a("EmojiState").updateRecentlyUsed(Y);var Z=U?[]:P.getTypeIDs(a("FantaTypeFileUploader").fileTypes.GENERIC_ATTACHMENT),$=r(R,x,Z,Q,T,P,F,G,U,H,E,O,z,M,B);if($){if(y!==R){var fa=u.tabGroup.tabs.get(y);u=u.deleteIn(["tabGroup","tabs",y]);u=u.deleteIn(["mercury","tabContents",y]);u=u.setIn(["tabGroup","tabs",R],fa.merge({id:R}));J=new(a("FantaTypeTabContents"))({id:R,composer:J.composer});u=u.setIn(["mercury","tabContents",R],J)}var ga=!T&&!U&&!E;if(u.mercury.tabContents.get(R)&&ga){J=J.merge({composer:new(a("FantaTypeComposer"))()});u=u.setIn(["mercury","tabContents",R],J)}}if($&&D)D($)}if(!p(P,Q)){J=J.merge({openSheet:null});u=u.setIn(["mercury","tabContents",R],J)}if(V&&O&&O.size>1)(function(){var ha=a("MercuryIDs").tokenize(R).value;a("Bootloader").loadModules(["MessengerWebChatEventsTypedLogger","MessengerWebChatEventType"],function(ia,ja){new ia().setEvent(ja.CLICK_NEW_MESSAGE).setOfflineThreadingID(ha).setEntryPoint(B).log()},"FantaReducersSendMessages")})();return u}return u}function p(u,v){return!!(u.uploadingFiles.size>0)}function q(u){var v=u.thread_id,w=a("MercuryIDs").getParticipantIDFromFromThreadID(v);if(w&&u)a("MercuryParticipants").get(w,function(x){a("Bootloader").loadModules(["MessageBlockedDialog"],function(y){y.show(v,u.can_reply,d.isMessageBlocked(u),x.short_name)},"FantaReducersSendMessages")})}function r(u,v,w,x,y,z,A,B,C,D,E,F,G,H,I){__p&&__p();if(!B)B=a("MercurySourceType").CHAT_WEB;var J=f.constructUserGeneratedMessageObject(v,a("MercurySourceType").CHAT_WEB,u);if(I){if(!J.tags)J.tags=[];var K=a("getPageIDFromThreadID")(u);if(K!==null&&Object.values(a("MessengerDiscoveryEntryPoint")).indexOf(I)!==-1)J.tags.push(a("MessengerDiscoveryEntryPointsLoggingHelper").getEntryPointsLoggingTagStr([I]));J.tags.push("web:trigger:"+I)}if(w.length>0){J.has_attachment=true;J.raw_attachments=w}if(G&&G.length)J.profile_ranges=J.profile_xmd=G;if(C){J.has_attachment=true;J.sticker_id=D}if(!C&&!y&&x.params&&x.type){var L={share_params:x.params.get("data"),share_type:x.type};if(L){J.has_attachment=true;J.shareable_attachment=L}}J.signatureID=H;J.ui_push_phase=a("SiteData").push_phase;if(!C&&E){J.content_attachment=null;e.addAttachmentPlaceholder(J,E.upload_id,E)}else if(!y){if(v||J.has_attachment)s(J,u,F);if(!C)t(z,u,F)}else if(A&&B){J.has_attachment=false;e.send(function(){a("EmojiLikeUtils").setEmojiSize(J,A||"");return a("EmojiLikeUtils").setEmojiSource(J,B||"")}())}g.markRead(u);g.markSeen(u);return J}function s(u,v,w){__p&&__p();if(i.isEmptyLocalThread(v)){if(w)g.addParticipants(v,w.toArray());u.offline_threading_id=a("MercuryIDs").tokenize(v).value;var x=i.getThreadMetaNow(v);if(x)u.specific_to_list=Array.from(x.participants)}e.send(u,function(v){var y=i.getThreadMetaNow(v);if(y&&a("MessageRequestUtils").isMessageRequest(y))g.movePendingToInbox(v);if(y&&y.thread_id&&y.other_user_fbid&&a("getPageIDFromThreadID")(y.thread_id))a("ChatTabViewEvents").inform("chat-send-to-page",{pageID:y.other_user_fbid})})}function t(u,v,w){__p&&__p();if(u.uploadedFiles.size===0)return;var x=a("MessengerUploadFilesUtil.bs").supportAttachments;for(var y in x){var z=a("MessengerUploadFilesUtil.bs").getAttachmentIDs(u,y);if(Array.isArray(z)){var A=f.constructAttachmentMessageObject(a("MercurySourceType").CHAT_WEB,v);A[x[y]]=z;s(A,v,w)}}}b.exports={sendGroupMessage:n,sendMessage:o,updateGroupName:m}}),null);